@model Booknix.Application.DTOs.AppointmentDetailDto

<div class="fixed inset-0 z-50 overflow-y-auto" id="appointment-detail-modal">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="fixed inset-0 transition-opacity bg-gray-800 bg-opacity-75 backdrop-blur-sm" aria-hidden="true"></div>
        
        <div class="relative bg-white rounded-lg max-w-md w-full mx-auto shadow-xl transform transition-all">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-gray-800">
                        Randevu Detayları
                    </h3>
                    <button type="button" class="close-modal text-gray-400 hover:text-gray-600 focus:outline-none">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-6">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center">
                            <i class="fas fa-calendar-day text-indigo-500"></i>
                        </div>
                        <div class="flex-grow">
                            <div class="text-sm font-medium text-gray-500">Tarih</div>
                            <div class="font-medium">@Model.AppointmentDate.ToString("dd.MM.yyyy")</div>
                        </div>
                    </div>
                    
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center">
                            <i class="fas fa-clock text-indigo-500"></i>
                        </div>
                        <div class="flex-grow">
                            <div class="text-sm font-medium text-gray-500">Saat</div>
                            <div class="font-medium">@Model.StartTime - @Model.EndTime</div>
                        </div>
                    </div>
                    
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center">
                            <i class="fas fa-map-marker-alt text-indigo-500"></i>
                        </div>
                        <div class="flex-grow">
                            <div class="text-sm font-medium text-gray-500">Lokasyon</div>
                            <div class="font-medium">@Model.LocationName</div>
                            <div class="text-sm text-gray-500 mt-1">@Model.LocationAddress</div>
                            <div class="text-sm text-gray-500">@Model.LocationPhone</div>
                        </div>
                    </div>
                    
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center">
                            <i class="fas fa-briefcase text-indigo-500"></i>
                        </div>
                        <div class="flex-grow">
                            <div class="text-sm font-medium text-gray-500">Servis</div>
                            <div class="font-medium">@Model.ServiceName</div>
                        </div>
                    </div>
                    
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center">
                            <i class="fas fa-user-tie text-indigo-500"></i>
                        </div>
                        <div class="flex-grow">
                            <div class="text-sm font-medium text-gray-500">Çalışan</div>
                            <div class="font-medium">@Model.WorkerName</div>
                        </div>
                    </div>
                    
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center">
                            <i class="fas fa-info-circle text-indigo-500"></i>
                        </div>
                        <div class="flex-grow">
                            <div class="text-sm font-medium text-gray-500">Durum</div>
                            @{
                                var statusClass = Model.Status switch
                                {
                                    "Bekliyor" => "bg-yellow-100 text-yellow-800",
                                    "Onaylandı" => "bg-green-100 text-green-800",
                                    "İptal Edildi" => "bg-red-100 text-red-800",
                                    "Tamamlandı" => "bg-blue-100 text-blue-800",
                                    _ => "bg-gray-100 text-gray-800"
                                };
                            }
                            <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full @statusClass">
                                @Model.Status
                            </span>
                        </div>
                    </div>
                    
                    @if (!string.IsNullOrEmpty(Model.Notes))
                    {
                        <div class="border-t pt-4 mt-4">
                            <div class="text-sm font-medium text-gray-500 mb-1">Notlar:</div>
                            <p class="text-sm text-gray-700">@Model.Notes</p>
                        </div>
                    }
                    
                    <div class="text-xs text-gray-400 mt-2">
                        Oluşturulma: @Model.CreatedAt.ToString("dd.MM.yyyy HH:mm")
                    </div>
                </div>
                
                <div class="flex justify-end mt-6 space-x-2">
                    @if (Model.Status == "Bekliyor" || Model.Status == "Onaylandı")
                    {
                        <button type="button" class="cancel-appointment-modal px-4 py-2 bg-red-600 text-white text-sm rounded hover:bg-red-700 focus:outline-none" data-id="@Model.Id">
                            İptal Et
                        </button>
                    }
                    <button type="button" class="close-modal px-4 py-2 bg-gray-200 text-gray-800 text-sm rounded hover:bg-gray-300 focus:outline-none">
                        Kapat
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        // Modalı kapat
        $(".close-modal").on("click", function() {
            $("#modal-container").addClass("hidden");
        });
        
        // Modaldan iptal etme
        $(".cancel-appointment-modal").on("click", function() {
            const appointmentId = $(this).data("id");
            
            if (confirm("Bu randevuyu iptal etmek istediğinizden emin misiniz?")) {
                $.ajax({
                    type: "POST",
                    url: "/Account/CancelAppointment/" + appointmentId,
                    data: {
                        id: appointmentId
                    },
                    success: function(response) {
                        // Modalı kapat
                        $("#modal-container").addClass("hidden");
                        
                        // Randevu listesini yeniden yükle
                        $.get("/Account/Appointments", function(html) {
                            $("#appointments-content").html(html);
                            
                            // Başarılı bildirim ekle
                            const alertHtml = `
                                <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-4" role="alert">
                                    <p>${response}</p>
                                </div>
                            `;
                            $("#appointments-content").prepend(alertHtml);
                            
                            // 5 saniye sonra bildirimi kaldır
                            setTimeout(function() {
                                $("#appointments-content .bg-green-100").fadeOut("slow", function() {
                                    $(this).remove();
                                });
                            }, 5000);
                        });
                    },
                    error: function(xhr) {
                        const errorMsg = xhr.responseText || "Randevu iptal işlemi başarısız oldu.";
                        alert(errorMsg);
                    }
                });
            }
        });
    });
</script> 