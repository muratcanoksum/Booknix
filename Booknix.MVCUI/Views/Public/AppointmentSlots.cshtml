@model Booknix.Application.DTOs.AppointmentSlotPageDto

@{
    ViewData["Title"] = "Randevu Seçimi";

    var groupedSlots = Model.Slots
        .GroupBy(s => s.Date)
        .OrderBy(g => g.Key)
        .ToList();
}
<div class="relative flex flex-col lg:flex-row gap-6 items-start">
    <!-- SOL: Slotlar -->
    <div class="w-full lg:w-2/3">
        <section class="mb-10">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Uygun Randevu Saatleri</h2>

            @if (!groupedSlots.Any())
            {
                <div class="text-sm text-gray-500">Bu tarih aralığında uygun saat bulunamadı.</div>
            }
            else
            {
                foreach (var dayGroup in groupedSlots)
                {
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-700 mb-2">
                            @dayGroup.Key.ToString("dddd, dd MMMM yyyy", new System.Globalization.CultureInfo("tr-TR"))
                        </h3>

                        <div class="flex flex-wrap gap-3">
                            @foreach (var slot in dayGroup)
                            {
                                <button class="bg-green-500 hover:bg-green-600 text-white text-sm font-medium px-4 py-2 rounded-lg shadow-sm transition">
                                    @slot.Time.ToString(@"hh\:mm")
                                </button>
                            }
                        </div>
                    </div>
                }
            }
        </section>
    </div>

    <!-- SAĞ: Bilgi kartı -->
    <div class="hidden lg:block w-1/3">
        <div id="infoCard" class="bg-white rounded-xl shadow-lg p-4 text-sm max-w-xs w-full absolute right-0 top-0">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Hizmet Bilgisi</h3>
            <div class="space-y-1 text-gray-700 mb-4">
                <p><span class="font-semibold">Lokasyon:</span> @Model.LocationName</p>
                <p><span class="font-semibold">Hizmet:</span> @Model.ServiceName</p>
                <p><span class="font-semibold">Süre:</span> @Model.Duration.TotalMinutes dakika</p>
                <p><span class="font-semibold">Ücret:</span> ₺@Model.Price</p>
                <p><span class="font-semibold">Çalışan:</span> @Model.WorkerName</p>
            </div>

            <hr class="my-3" />

            <div class="text-gray-600 text-sm mb-3">
                Seçilen saat: <span id="selectedTime">Henüz seçilmedi</span>
            </div>

            <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold w-full py-2 rounded-md text-sm transition">
                Randevuyu Seç
            </button>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const card = document.getElementById("infoCard");

        window.addEventListener("scroll", () => {
            const offset = window.scrollY;
            card.style.transform = `translateY(${offset}px)`;
        });
    </script>
}
