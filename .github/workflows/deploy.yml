name: ðŸš€ Deploy to Plesk via FTP

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x' # Projeye gÃ¶re deÄŸiÅŸebilir

    - name: Publish .NET project
      run: dotnet publish Booknix.MVCUI/Booknix.MVCUI.csproj -c Release -o publish

    - name: ðŸš§ Add App_Offline.htm to stop app temporarily
      run: |
        mkdir -p publish/booknix.ismailparlak.com
        echo "<!DOCTYPE html><html><head><title>Maintenance</title></head><body><h1>Site is under maintenance. Please try again later.</h1></body></html>" > publish/booknix.ismailparlak.com/App_Offline.htm

    - name: ðŸš€ Deploy via FTP
      uses: SamKirkland/FTP-Deploy-Action@v4.3.4
      with:
        server: ${{ secrets.FTP_SERVER }}
        username: ${{ secrets.FTP_USERNAME }}
        password: ${{ secrets.FTP_PASSWORD }}
        local-dir: publish/
        server-dir: booknix.ismailparlak.com/
    
    - name: âœ… Remove App_Offline.htm to bring app online
      run: curl -u ${{ secrets.FTP_USERNAME }}:${{ secrets.FTP_PASSWORD }} -Q "-DELE booknix.ismailparlak.com/App_Offline.htm" ftp://${{ secrets.FTP_SERVER }}
