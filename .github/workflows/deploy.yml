name: ğŸš€ Deploy to Plesk via FTP

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: windows-latest

    steps:
    - name: ğŸ“¥ Checkout source code
      uses: actions/checkout@v4

    - name: âš™ï¸ Setup .NET SDK
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'

    - name: ğŸ›‘ Put App_Offline.htm (stop site)
      run: |
        echo "::group::ğŸ›‘ Creating App_Offline.htm and uploading..."
        echo "::notice title=BakÄ±m BaÅŸlatÄ±lÄ±yor::Uygulama geÃ§ici olarak durduruluyor..."
        echo "<!DOCTYPE html><html lang='tr'><head><meta charset='UTF-8'><meta name='viewport' content='width=device-width, initial-scale=1.0'><title>BakÄ±mdayÄ±z - Booknix</title><style>body{background-color:#f3f4f6;color:#1f2937;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;display:flex;align-items:center;justify-content:center;flex-direction:column;height:100vh;margin:0;text-align:center}h1{font-size:2rem;margin-bottom:1rem}p{font-size:1rem;color:#4b5563;max-width:400px}</style></head><body><h1>Åu anda bakÄ±mdayÄ±z.</h1><p>Booknix hizmetlerini geliÅŸtirmek iÃ§in kÄ±sa bir bakÄ±mdayÄ±z. LÃ¼tfen daha sonra tekrar deneyin. AnlayÄ±ÅŸÄ±nÄ±z iÃ§in teÅŸekkÃ¼r ederiz.</p></body></html>" > App_Offline.htm
        curl -T App_Offline.htm --ftp-method nocwd -u ${{ secrets.FTP_USERNAME }}:${{ secrets.FTP_PASSWORD }} ftp://${{ secrets.FTP_SERVER }}/booknix.ismailparlak.com/
        echo "::endgroup::"

    - name: ğŸ—ï¸ Publish .NET project
      run: |
        echo "::group::ğŸ“¦ Publishing project..."
        dotnet publish Booknix.MVCUI/Booknix.MVCUI.csproj -c Release -o publish
        echo "<!-- dummy -->" > publish/App_Offline.htm
        echo "::endgroup::"

    - name: ğŸš€ Deploy via FTP (excluding App_Offline.htm)
      uses: SamKirkland/FTP-Deploy-Action@v4.3.4
      with:
        server: ${{ secrets.FTP_SERVER }}
        username: ${{ secrets.FTP_USERNAME }}
        password: ${{ secrets.FTP_PASSWORD }}
        local-dir: publish/
        server-dir: booknix.ismailparlak.com/
        exclude: |
          App_Offline.htm

    - name: âœ… Done! App is now live.
      run: |
        echo "::notice title=YayÄ±n TamamlandÄ±::Booknix baÅŸarÄ±yla yayÄ±na alÄ±ndÄ±! ğŸ‰"
